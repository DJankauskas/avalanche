<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Hooks, state, and control flow - Avalanche + Avalanche Web Tutorial</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        
        <link rel="stylesheet" href="css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="introduction.html">Introduction</a></li><li class="chapter-item expanded "><a href="getting_started.html"><strong aria-hidden="true">1.</strong> Getting started</a></li><li class="chapter-item expanded "><a href="basic_components.html"><strong aria-hidden="true">2.</strong> Basic components</a></li><li class="chapter-item expanded "><a href="state.html" class="active"><strong aria-hidden="true">3.</strong> Hooks, state, and control flow</a></li><li class="chapter-item expanded "><a href="reactivity.html"><strong aria-hidden="true">4.</strong> Reactivity</a></li><li class="chapter-item expanded "><a href="events.html"><strong aria-hidden="true">5.</strong> Event handling and input elements</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Avalanche + Avalanche Web Tutorial</h1>

                    <div class="right-buttons">
                        
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#hooks-state-and-control-flow" id="hooks-state-and-control-flow">Hooks, State, and Control Flow</a></h1>
<p>Earlier, we described components as pure functions. Hooks allow us 
to introduce external data, state, and other impure data into our components.</p>
<h2><a class="header" href="#hooks" id="hooks">Hooks</a></h2>
<p>So far, all the data we've passed to parameters and used in general was static, specified at compilation time.
But in real apps, we usually need to maintain state for things like network request statuses and inputs.</p>
<p>Let's say we're trying to write a counter. We'll start out with a stateless counter:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use avalanche::{component, tracked, View};
use avalanche_web::components::{Div, H2, Button, Text};

#[component]
fn Counter() -&gt; View {
    Div(self, [
        H2(self, [
            Text(self, &quot;Counter!&quot;)
        ]),
        Button(
            self,
            on_click = |_| todo!(),
            [
                Text(self, &quot;+&quot;)
            ]
        ),
        Text(self, 0.to_string())
    ])
}
<span class="boring">}
</span></code></pre></pre>
<p>Since we don't keep track of the count yet, we've substituted it with the value <code>0</code>. <code>Text</code>'s <code>text</code> parameter accepts any value that implements <code>ToString</code>,
so we can pass <code>0</code> instead of <code>&quot;0&quot;</code>. We've also defined the <code>on_click</code> handler for <code>Button</code>, so the given closure's code will run on every click. 
Since right now we have no state to update yet, we call <code>todo!()</code>, so clicking the button would crash our app. </p>
<p>Now that we have our starting point, let's finally inject some state. The <code>state</code> hook allows us to inject
state so we can keep track of the number of clicks. Since we have a count that monotonically increases, we can use an unsigned integer <code>u64</code> with <code>state&lt;u64, _&gt;</code>.</p>
<p>Let's finally make our counter stateful with the <code>state</code> hook:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use avalanche::{component, tracked, state, View};
use avalanche_web::components::{Div, H2, Button, Text};

#[component]
fn Counter() -&gt; View {
    let (count, set_count) = state::&lt;u64&gt;(self, || 0);

    Div(self, [
        H2(self, [
            Text(self, &quot;Counter!&quot;)
        ]),
        Button(
            self,
            on_click = move |_| set_count.update(|count| *count += 1),
            [
                Text(self, &quot;+&quot;)
            ]
        ),
        Text(self, tracked!(count).to_string())
    ])
}
<span class="boring">}
</span></code></pre></pre>
<p>Hooks are function calls that take <code>self</code> as their first parameter. This allows <code>#[component]</code> to know the function call is 
a hook, allowing it to pass in some internal state. Hooks have a call site identity, so the above <code>state</code> call will return a reference
to the same state every render. A different <code>state</code> call elsewhere in the code, however, would reference different state. </p>
<p>The <code>state</code> hook takes the context <code>self</code> and a function providing the state's default value for <code>u64</code> and returns a tuple with a reference to the 
current state (which we name <code>count</code>) and a setter, which we name <code>set_count</code>. The setter has an <code>update</code> method which accepts a closure that receives a <code>&amp;mut u64</code> and modifies it. Every time the user clicks on the button, <code>on_click</code> fires, calling <code>set_counter.update()</code>, which runs 
<code>*count += 1</code>, updating the state and causing the component to be rerendered. </p>
<p>Note that the reference returned is <em>tracked</em>, so here we get <code>Tracked&lt;&amp;u64&gt;</code> instead of <code>&amp;u64</code>. This is where the tracked system becomes useful.
Constant values, when passed into components, are never considered updated. But if we called <code>set_count.updated</code> since the last time we called <code>state</code>,
on the next call of <code>state</code>, <code>count</code> will be marked as updated. That lets <code>avalanche</code> know we should update the text of <code>Text(self, tracked!(count).to_string())</code> in the UI.</p>
<p>The state returned by each call site of <code>state</code> is unique. If we call <code>state</code> in two different places, their values aren't linked.</p>
<blockquote>
<p>If you've used React before, you might be familiar with the rules of hooks. Those don't apply here:
feel free to call hooks within <code>if</code>, loops, and other complex control flow! You do still need to 
keep hook calls inside of components, but that's enforced at compile time.</p>
</blockquote>
<p>With that, we have our first stateful component! If we instead wanted to simply 
set the state to a value like <code>0</code>, we could write <code>set_count.set(0)</code> as a shorthand for <code>set_count.update(|count| *count = 0)</code>.</p>
<h2><a class="header" href="#dynamic-rendering" id="dynamic-rendering">Dynamic rendering</a></h2>
<p>Oftentimes, we don't just want to update property values based on changes to state and props, but also what children we render.
In some frameworks, that requires special template syntax, but we can take advantage of the fact that the <code>Component!()</code> syntax returns plain 
Rust values to use normal control flow instead.</p>
<h3><a class="header" href="#conditional-rendering" id="conditional-rendering">Conditional rendering</a></h3>
<p>Want to render something only if a condition is true? Use an <code>if</code> statement:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">use avalanche::{component, tracked, View};
</span><span class="boring">use avalanche_web::components::Text;
</span><span class="boring">
</span>#[component]
fn Conditional(cond: bool) -&gt; View {
    if tracked!(cond) {
        Text(self, &quot;True!&quot;)
    } else {
        ().into()
    }
}
<span class="boring">}
</span></code></pre></pre>
<blockquote>
<p>From this point, we'll be omitting previously used <code>avalanche</code> and <code>avalanche_web</code> imports for brevity.</p>
</blockquote>
<p>The <code>()</code> type is a special <code>Component</code> that renders nothing. We call <code>.into()</code> on it to turn it into a <code>View</code>.</p>
<p>There is also a shorthand for this some component-or-nothing case:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">use avalanche::{component, tracked, View};
</span><span class="boring">use avalanche_web::components::Text;
</span><span class="boring">
</span>#[component]
fn Conditional(cond: bool) -&gt; View {
    tracked!(cond).then(|| Text(self, &quot;True!&quot;)).into()
}
<span class="boring">}
</span></code></pre></pre>
<p>That's equivalent to the above example. This uses <a href="https://doc.rust-lang.org/std/primitive.bool.html#method.then"><code>bool</code>'s then method</a>.
<code>Option&lt;View&gt;</code> is also a special component, rendering the <code>View</code> in its <code>Some</code> case and rendering nothing in its 
<code>None</code> case. Of course, if you want more complex conditionals, you can use other control flow like <code>else if</code> and 
<code>match</code>.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="basic_components.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="reactivity.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="basic_components.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="reactivity.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
